@echo off

REM HERITRACE {{PACKAGE_TYPE_TITLE}} Testing - Windows Stop Script
REM Usage: stop.cmd

echo [STOP] Stopping HERITRACE {{PACKAGE_TYPE_TITLE}} Testing Environment
echo ==============================================

REM Detect the correct Docker Compose command
docker compose version >nul 2>&1
if errorlevel 0 (
    set COMPOSE_CMD=docker compose
) else (
    docker-compose version >nul 2>&1
    if errorlevel 0 (
        set COMPOSE_CMD=docker-compose
    ) else (
        echo [ERROR] Error: Docker Compose is not available!
        echo    Please ensure Docker Compose (v2) or docker-compose (v1) is installed and accessible.
        pause
        exit /b 1
    )
)

REM Stop and remove containers
echo [DOCK] Stopping Docker containers...
%COMPOSE_CMD% down

if errorlevel 1 (
    echo [ERROR] Error stopping containers!
    pause
    exit /b 1
)

echo [OK] All services stopped!
echo.
echo [INFO] Your test data is preserved in Docker volumes.
echo    To restart, simply double-click: start.cmd
echo.
echo [EXPORT] Once the test is complete, don't forget to export the results!
{{EXPORT_MESSAGE}}
echo.
echo Press any key to continue...
pause >nul